"use strict";function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var app=controllerFunc("ngScope","ngController",function(e,t,a,o){function n(){e.checkUse=!0,m?c():p(),d()}function i(a,o){t({method:"POST",params:{pageSize:"1",type:a,pIds:u,pageNum:o},url:BaseUrl+"product1/searchProductImgList"}).then(function(t){if(console.log(t),console.log(t.data.totalCount>10),t.data.totalCount>10)switch(console.log(t.data.totalCount),a){case"2":if(S)return i(a,t.data.totalCount),void(S=!1);break;case"3":if(v)return i(a,t.data.totalCount),void(v=!1);break;case"4":if(D)return i(a,t.data.totalCount),void(D=!1)}2==a?e.travelList=t.data.data:3==a?(e.payList=t.data.data,e.payList||(e.payListShow=!0)):4==a&&(e.infoList=t.data.data,console.error(e.infoList),e.infoList||(e.infoListShow=!0))},function(e){console.error("数据请求失败")})}function s(){function t(e){e.addClass("travel-tab-active"),e.siblings().removeClass("travel-tab-active")}2==y?setTimeout(function(){T=.7*C;for(var a=document.documentElement.getElementsByClassName("info_imgA"),o=0;o<a.length;o++)T+=a[o].offsetHeight;T>50&&$(".swiper-container-content").css("height",T);var n=$(".tab"),i=new Swiper(".swiper-container-content",_defineProperty({direction:"horizontal",scrollbar:".swiper-scrollbar",scrollbarHide:!1,onSlideChangeEnd:function(e){}},"onSlideChangeEnd",function(a){var o=a.activeIndex;if("1"==o){b=.7*C,F=e.payListShow?document.documentElement.getElementsByClassName("info_imgB"):document.documentElement.getElementsByClassName("info_imgC");for(var i=0;i<F.length;i++)b+=F[i].offsetHeight;$(".swiper-container-content").css("height",b)}else if("2"==o){w=.7*C;var s=document.documentElement.getElementsByClassName("info_imgC");console.log(s);for(var i=0;i<s.length;i++)w+=s[i].offsetHeight;$(".swiper-container-content").css("height",w)}else{T=.7*C;for(var l=document.documentElement.getElementsByClassName("info_imgA"),i=0;i<l.length;i++)T+=l[i].offsetHeight;$(".swiper-container-content").css("height",T)}t(n.eq(a.activeIndex))}));$(n).on("click",function(){var a=$(this).index();if("1"==a){b=.7*C,F=e.payListShow?document.documentElement.getElementsByClassName("info_imgB"):document.documentElement.getElementsByClassName("info_imgC");for(var o=0;o<F.length;o++)b+=F[o].offsetHeight;$(".swiper-container-content").css("height",b)}else if("2"==a){w=.7*C;for(var s=document.documentElement.getElementsByClassName("info_imgC"),o=0;o<s.length;o++)w+=s[o].offsetHeight;$(".swiper-container-content").css("height",w)}else{T=.7*C;for(var l=document.documentElement.getElementsByClassName("info_imgA"),o=0;o<l.length;o++)T+=l[o].offsetHeight;$(".swiper-container-content").css("height",T)}t(n.eq(a)),i.slideTo(a,1e3,!1)})},200):y++}function l(){var t=[],a=e.pFirstFee||"0";switch(e.fBtype){case"1":"1"===e.fCmethodType?(e.rateDescription="最终手续费=【(订单金额-首付) * 手续费比例】",e.poundage=(e.forTotalMoney-e.pFirstFee)*e.fFee):"2"===e.fCmethodType&&(e.rateDescription="最终手续费=【手续费金额】】",e.poundage=e.fFee);break;case"2":"1"===e.fCmethodType&&"1"===e.fSwayType?(e.rateDescription="最终手续费=【(订单金额-首付) * (手续费比例- 供应商贴息比例)】",e.poundage=(e.forTotalMoney-e.pFirstFee)*(e.fFee-e.fSwayFee)):"1"===e.fCmethodType&&"2"===e.fSwayType&&(e.rateDescription="最终手续费=【(订单金额-首付) * 手续费比例 - 供应商贴补金额】",e.poundage=(e.forTotalMoney-e.pFirstFee)*e.fFee-e.fSwayFee);break;case"3":var o=e.fDuration.split("/"),n=e.fFee.split(","),i=conversion(o),s=conversion(n);if(e.poundages=[],n.length==o.length)for(var l=0;l<o.length;l++)e.poundages[l]=(e.forTotalMoney-e.pFirstFee)*s[l];for(var r=0;r<i.length;r++){var d={},c=e.forTotalMoney-a;e.allTotalMoney=c,d.price=(c/i[r]+e.poundages[r]).toFixed(2),d.fq=i[r],d.pFirstFee=e.pFirstFee,d.poundage=e.poundages[r]/d.fq,d.fFee=s[r],d.initFee=parseInt(100*s[r]),t.push(d)}e.installmentItems=t,e.aomountInstallment=e.installmentItems[i.length-1].price,e.staging=e.installmentItems[i.length-1].fq}if("3"!=e.fBtype){for(var r=0;r<e.fqNum.length;r++){var d={},p=e.forTotalMoney-a;e.allTotalMoney=p,d.price=(p/e.fqNum[r]+e.poundage).toFixed(2),d.fq=e.fqNum[r],d.pFirstFee=e.pFirstFee,d.poundage=e.poundage/d.fq,d.fFee=e.fFee,d.initFee=(100*d.fFee).toPrecision(1),t.push(d)}e.installmentItems=t,e.aomountInstallment=e.installmentItems[e.fqNum.length-1].price,e.staging=e.installmentItems[e.fqNum.length-1].fq}}function r(){m?t({method:"POST",params:{pId:u,token:m},url:BaseUrl+"product1/searchProductDetail"}).then(function(t){e.siKefuMobile=t.data.data.siKefuMobile,e.pTotalMoney=formatNum(t.data.data.pTotalMoney),e.pYoungMoney=formatNum(t.data.data.pYoungMoney),e.departureMonth=t.data.data.departureMonth.replace(/,/g,"、"),e.pTitle=t.data.data.pTitle;var a=t.data.data.fDuration;e.fDuration=a.replace(/,/g,"/"),e.pTitleSub=t.data.data.pTitleSub,e.salesCount=t.data.data.saleCount,e.images=t.data.imageData,e.status=t.data.data.status,h=e.status,"1"==e.status?$(".col").html("&#xe650;").css("color","#ebc223"):$(".col").html("&#xe683;").css("color","#ffff"),e.fBtype=t.data.fDurationData.fBtype,e.fCmethodType=t.data.fDurationData.fCmethodType,e.fFee=t.data.fDurationData.fFee,e.fSwayType=t.data.fDurationData.fSwayType,e.pFirstFee=toDecimal2(t.data.data.pFirstFee),e.myFistFee=parseInt(e.pFirstFee),e.pFirstFee=parseInt(e.pFirstFee),e.fSwayFee=t.data.fDurationData.fSwayFee,e.fqNum=a.split(",");var o=e.fqNum.length;e.forTotalMoney=parseFloat(e.pYoungMoney.replace(/,/g,"")),e.fenNum=o,l(),setTimeout(function(){e.initBanner()},500),e.toPage=function(o){m?"ios"===e.appType?window.webkit?e.checkUse?window.webkit.messageHandlers.uploadContract.postMessage({pId:u,installment:a,pTitle:e.pTitle,subTitle:e.pTitleSub}):window.webkit.messageHandlers.realNameAuthentication.postMessage({token:m}):e.checkUse?uploadContract(u,a,e.pTitle,e.pTitleSub):realNameAuthentication(m):"android"===e.appType?e.checkUse?android.uploadContract(u,a,e.pTitle,e.pTitleSub):android.realNameAuthentication(m):e.checkUse?go_page("./travel_upload_contract.html",[{pId:u},{fDuration:t.data.data.fDuration},{pTitle:t.data.data.pTitle},{pTitleSub:t.data.data.pTitleSub},{isQianyue:"1"}]):go_page("./travel_upload_cdCard.html"):go_page("../account/user_login.html",[{toUrl:window.location.href}])},e.hideDialog=function(){$("#travel-choose-dialog").css("display","none")},e.toPage1=function(e){switch(e){case"取消":$("#travel-choose-dialog").css("display","none");break;case"未签约":go_page("./travel_choose_product.html",[{pId:u},{signing:!0},{installment:t.data.data.fDuration},{pTitle:t.data.data.pTitle},{pTitleSub:t.data.data.pTitleSub}])}}},function(e){console.error("数据请求失败")}):t({method:"POST",params:{pId:u},url:BaseUrl+"product1/searchProductDetail"}).then(function(t){e.siKefuMobile=t.data.data.siKefuMobile,e.pTotalMoney=formatNum(t.data.data.pTotalMoney),e.pYoungMoney=formatNum(t.data.data.pYoungMoney),e.departureMonth=t.data.data.departureMonth.replace(/,/g,"、"),e.pTitle=t.data.data.pTitle;var a=t.data.data.fDuration;e.fDuration=a.replace(/,/g,"/"),e.pTitleSub=t.data.data.pTitleSub,e.salesCount=t.data.data.saleCount,e.images=t.data.imageData,e.status=t.data.data.status,h=e.status,"1"==e.status?$(".col").html("&#xe650;").css("color","#ebc223"):$(".col").html("&#xe683;").css("color","#ffff"),e.fBtype=t.data.fDurationData.fBtype,e.fCmethodType=t.data.fDurationData.fCmethodType,e.fFee=t.data.fDurationData.fFee,e.fSwayType=t.data.fDurationData.fSwayType,e.pFirstFee=toDecimal2(t.data.data.pFirstFee),e.myFistFee=parseInt(e.pFirstFee),e.pFirstFee=parseInt(e.pFirstFee),e.fSwayFee=t.data.fDurationData.fSwayFee,e.fqNum=a.split(",");var o=e.fqNum.length;e.forTotalMoney=parseFloat(e.pYoungMoney.replace(/,/g,"")),e.fenNum=o,l(),setTimeout(function(){e.initBanner()},500),e.toPage=function(o){m?"ios"===e.appType?window.webkit?e.checkUse?window.webkit.messageHandlers.uploadContract.postMessage({pId:u,installment:a,pTitle:e.pTitle,subTitle:e.pTitleSub}):window.webkit.messageHandlers.realNameAuthentication.postMessage({token:m}):e.checkUse?uploadContract(u,a,e.pTitle,e.pTitleSub):realNameAuthentication(m):"android"===e.appType?e.checkUse?android.uploadContract(u,a,e.pTitle,e.pTitleSub):android.realNameAuthentication(m):e.checkUse?go_page("./travel_upload_contract.html",[{pId:u},{fDuration:t.data.data.fDuration},{pTitle:t.data.data.pTitle},{pTitleSub:t.data.data.pTitleSub},{isQianyue:"1"}]):go_page("./travel_upload_cdCard.html"):go_page("../account/user_login.html",[{toUrl:window.location.href}])},e.hideDialog=function(){$("#travel-choose-dialog").css("display","none")},e.toPage1=function(e){switch(e){case"取消":$("#travel-choose-dialog").css("display","none");break;case"未签约":go_page("./travel_choose_product.html",[{pId:u},{signing:!0},{installment:t.data.data.fDuration},{pTitle:t.data.data.pTitle},{pTitleSub:t.data.data.pTitleSub}])}}},function(e){console.error("数据请求失败")})}function d(){r()}function c(){t({method:"POST",params:{token:m},url:BaseUrl+"members/searchRealNameStatus"}).then(function(t){t.data.result==SUCCESS_CODE&&(0==t.data.status||0==t.data.accountStatus)&&(e.checkUse=!1),p()})}function p(){e.goBack=function(){f?"ios"==e.appType?backHome():"android"==e.appType&&android.backHome():GetQueryString2("isLogin")&&1==GetQueryString2("isLogin")?"ios"==e.appType?backHome():"android"==e.appType?android.backHome():toIndex():"ios"==e.appType?backHome():"android"==e.appType?android.backHome():window.history.back()},e.reservePro=function(){e.nowSubmit&&(m?e.checkUse?(e.dialogInfo="已签订旅游合同开始上传",e.dialogDown="未签约"):(e.dialogInfo="前往实名认证",e.dialogDown="取消"):(e.dialogInfo="还没登录,立即登录",e.dialogDown="取消"),$("#detailMenu").animateCss("fadeInUp"),$("#travel-choose-dialog").css("display","block"))},e.shareDetail=function(){switch(e.appType){case"android":android.fenqihuiShare();break;case"ios":fenqihuiShare();break;case"weixin":break;default:e.dialogObj.conetent.innerHTML="请在微信中使用此功能",e.dialogObj.show()}}}e.dialogObj=new Dialog(DIALOG_DIALOG),e.dialog=!1,e.msg="",e.isMsg=!0,e.isShelter=!1;var u=GetQueryString("pId"),f=GetQueryString("sourcePage")||"",g=GetQueryString("ps");e.nowSubmit=!0,("pi"==g||g)&&(e.nowSubmit=!1),e.appType=getTypeNative();var m=getToken(),h="2",y=0;"ios"==e.appType&&$("#travel_detail_guideNav").css("top","30px"),n(),e.renderFinish=function(){s()},e.initBanner=function(){new Swiper(".swiper-container",{direction:"horizontal",autoplay:5e3,loop:!0,pagination:".swiper-pagination",observer:!0,observeParents:!0,lazyLoading:!0});e.$apply(function(){e.dialog=!1})},i("2","10"),i("3","10"),i("4","10");var T,b,w,F,S=!0,v=!0,D=!0,C=parseFloat(document.getElementsByTagName("html")[0].style.fontSize);e.$watch("msg",function(t,o){a(function(){e.isMsg=!0},1e3,!0)},!1),e.telPhone=function(){var t=getTypeNative();"android"==t?android.callPhone(e.siKefuMobile):"ios"==t&&callPhone(e.siKefuMobile)},e.collection=function(){m?"0"==h?t({method:"POST",url:BaseUrl+"product1/addProductCollection",params:{token:getToken(),pId:u}}).then(function(t){h="1",e.msg="收藏"+t.data.message,e.isMsg=!1,$(".col").html("&#xe650;").css("color","#ebba24")},function(){e.msg="收藏失败",e.isMsg=!1}):(h="0",t({method:"POST",url:BaseUrl+"product1/cancelProductCollection",params:{token:getToken(),pId:u}}).then(function(t){e.msg="取消"+t.data.message,e.isMsg=!1,$(".col").html("&#xe683;").css("color","#ebba24")},function(){e.msg="取消失败",e.isMsg=!1})):(e.dialogInfo="还没登录,立即登录",e.dialogDown="取消",$("#detailMenu").animateCss("fadeInUp"),$("#travel-choose-dialog").css("display","block"))},e.closeStag=function(){e.isShelter=!1},e.showLayer=function(){e.isShelter=!0}});