"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};controllerFunc("travel-choose-product","travel-choose",function(e,t,n){function a(){t({method:"POST",params:{pId:e.pId},url:BaseUrl+"product1/searchMealsYearMonthList"}).then(function(t){if(t.data.result){e.comboName=t.data.data[0].mYearMonth,e.packageItems=t.data.data;var n="&#xe672;",a="&#xe7c8;";o(t.data.data[0].mName),e.renderFinish=function(){$(".iconfont-checkbox").eq(0).html("&#xe7c8;"),$(".travel-choose-box").eq(0).select_css("selectCombo"),$(".iconfont-checkbox").eq(0).data("selected","true")},e.selectCheckBox=function(t,l,i){var c=$(".travel-choose-box").eq(i).children("i");c.data("selected")?c.data("selected","false"):(c.parent("section").siblings().children("i").html(n),c.parent("section").siblings().children("i").data("selected","false"),c.parent("section").animateCss("pulse"),c.html(a),c.parent("section").select_css("selectCombo"),c.data("selected","true"),e.comboName=t,o(t))}}},function(e){console.error("数据请求失败")})}function o(a){t({method:"POST",params:{mName:a,pId:e.pId},url:BaseUrl+"product1/searchMealsYearMonthList"}).then(function(t){t.data.result===SUCCESS_CODE&&(e.dateItems=t.data.data,s(a,t.data.data[0].mYearMonth,t.data.data[0].mYearMonth),e.dateTagLength=t.data.data.length,e.dateItems=t.data.data,e.selectedRow=0,e.renderDateFinish=function(){n(w(),300)})},function(){})}function l(){if(-1!=e.installmentSelectedRow){console.log("pppp"+e.installmentItems[e.installmentSelectedRow].price);var t=e.installmentItems[e.installmentSelectedRow].price,n=e.installmentItems[e.installmentSelectedRow].fq;e.installmentNumShow=t+"×"+n+"期",e.installmentNumShowPass=formatNum(t)+"×"+n+"期",e.newInstallmentNumShowPass=formatNum(t)+"元 ×"+n+"期",e.oTotalDuration=n,e.oDurationMoney=t,e.installmentEachPrice=t}}function i(){var t=[];e.pFirstFee||"0";switch(e.downPayment=parseInt(e.downPayment),e.fBtype){case"1":"1"===e.fCmethodType?(e.rateDescription="与最低手续费相加不超过总额",e.poundage=(e.calTotalPrice-e.downPayment)*e.fFee,console.log("计算费率   :"+e.downPayment+"    aaaaaa"),e.poundage=parseFloat(e.poundage.toFixed(2)),console.log("计算费率   :"+e.poundage+"    ssssss")):"2"===e.fCmethodType&&(e.rateDescription="与最低手续费相加不超过总额",e.poundage=e.fFee);break;case"2":"1"===e.fCmethodType&&"1"===e.fSwayType?(e.rateDescription="与最低手续费相加不超过总额",e.poundage=(e.calTotalPrice-e.downPayment)*(e.fFee-e.fSwayFee),e.poundage=parseFloat(e.poundage.toFixed(2))):"1"===e.fCmethodType&&"2"===e.fSwayType&&(e.rateDescription="与最低手续费相加不超过总额",e.poundage=(e.calTotalPrice-e.downPayment)*e.fFee-e.fSwayFee,e.poundage=parseFloat(e.poundage.toFixed(2)));break;case"3":e.rateDescription="与最低手续费相加不超过总额";var n=e.installmentNum.split(","),a=e.fFee.split(","),o=conversion(n),l=conversion(a);if(e.poundages=[],a.length==n.length)for(var i=0;i<n.length;i++)e.poundages[i]=(e.calTotalPrice-e.downPayment)*l[i],console.log(e.poundages[i]+"AA 费率最低lilv： "+l[i]);for(var c=0;c<o.length;c++){var r={},d=e.calTotalPrice-e.downPayment;e.allTotalMoney=d,console.info("AA计算费率为"+e.poundages[c]+"计算总价为"+d),r.price=(d/o[c]+e.poundages[c]).toFixed(2),console.info("分期数： "+o[c]),console.info(e.poundages[c]+"ttttttttttttt1111"),r.fq=o[c],r.pFirstFee=e.pFirstFee,r.poundage=e.poundages[c]/r.fq,r.fFee=l[c],r.initFee=100*l[c],console.log(r.initFee+"   显示费率"),t.push(r)}e.installmentItems=t,e.aomountInstallment=e.installmentItems[0].price,console.error(e.aomountInstallment+"11111111"),e.staging=e.installmentItems[0].fq}if("3"!=e.fBtype){for(var c=0;c<e.fqNum.length;c++){var r={},s=e.calTotalPrice-e.downPayment;e.allTotalMoney=s,console.log("installmentAllMoney: "+e.downPayment),console.info("AA计算费率为"+e.poundage+"计算总价为"+s),r.price=(s/e.fqNum[c]+e.poundage).toFixed(2),r.fq=e.fqNum[c],t.push(r)}e.installmentItems=t}}function c(){return S?void(S>e.downPayment||e.downPayment<e.mFirstFee?(e.downPayInfo="*首付价不可低于最低首付",console.error(S+"zzzzzzzzzzzzzzzzzzzzzzz"),e.downPayment=S,e.isError=!0,e.payCheckInfo=!0):e.calTotalPrice<e.downPayment?(e.downPayInfo="*首付价不可超出总价",e.isError=!0,e.payCheckInfo=!0):(e.isError=!1,e.payCheckInfo=!1)):void(S=0)}function r(){return S?void(S>e.downPayment||e.downPayment<e.mFirstFee?(e.downPayInfo="*首付价不可低于最低首付",console.error(S+"zzzzzzzzzzzzzzzzzzzzzzz"),e.isError=!0,e.payCheckInfo=!0):e.calTotalPrice<e.downPayment?(e.downPayInfo="*首付价不可超出总价",e.isError=!0,e.payCheckInfo=!0):(e.isError=!1,e.payCheckInfo=!1)):void(S=0)}function d(){e.$watch("calTotalPrice",function(e,t,n){i(),c(),l()}),e.$watch("downPayment",function(t,n,a){t&&(t==n||(i(),r(),e.checkFirstPayment(),l()))})}function s(n,a,o){t({method:"POST",params:{mYearMonth:a,pId:e.pId},url:BaseUrl+"product1/searchMealsDetailList"}).then(function(t){if(t.data.result===SUCCESS_CODE){var a=t.data.data[0],l=t.data.feeData;e.oMealsId=a.mId,e.adultPollRoom=a.mOutDfc,e.adultPrice=a.mOutPriceYoung,e.childPrice=a.mOutPriceChildren,e.oldPrice=a.mOutPriceOld,e.AdultRemainTicket=a.mStock,e.ChildRemainTicket=a.mStockChilren,e.OldRemainTicket=a.mStockOld,e.mTotalStock=a.mTotalStock,N(),e.mFirstFee=parseInt(a.pFirstFee),e.downPayment=a.pFirstFee,e.showDownPayment=parseInt(e.downPayment),e.backupDownPayment=a.mFirstFee,e.fBtype=l.fBtype,e.fCmethodType=l.fCmethodType,e.fFee=l.fFee,e.fSwayType=l.fSwayType,e.fSwayFee=l.fSwayFee,console.log(e.adultPollRoom+"   wwwww"),i(),d(),e.calTotalPrice=p(),m(o,t.data.data),e.selectDate=function(t,a,o){e.selectedRow=o,$(".swiper-slide").eq(o).animateCss("pulse"),s(n,t,t)}}})}function m(e,t){var n=e.split("-"),a=n[0],o=n[1],l=u(a,o),i=new Date(a,o-1,1).getDay();new Date(a,o,1).getDay();$("#dynamic-ul").length>0&&$("#dynamic-ul").remove(),y(l,t,i,o,a)}function u(e,t){var n;return n=2==t?e%4==0?29:28:1==t||3==t||5==t||7==t||8==t||10==t||12==t?31:30}function p(){return e.calTotalPrice=e.engineer.chilCurrentNum*e.childPrice+e.engineer.adultCurrentNum*e.adultPrice+e.engineer.oldCurrentNum*e.oldPrice+e.SingleRoomPoll,h(),console.info("AA计算总价为"+e.calTotalPrice),console.info("AA分别计算价格为AA小孩"+e.engineer.chilCurrentNum*e.childPrice+"AA成人"+e.engineer.adultCurrentNum*e.adultPrice+"AA老人"+e.engineer.oldCurrentNum*e.oldPrice),e.calTotalPrice}function f(){t({method:"POST",params:{token:e.token},url:BaseUrl+"/members/searchCredit"}).then(function(t){t.data.result===SUCCESS_CODE&&(console.log(t.data.data),e.startInfo=t.data.data.startInfo,"0"==e.startInfo?e.creditMoney=0:"3"==e.startInfo?e.creditMoney=5e3:"4"==e.startInfo?e.creditMoney=1e4:"5"==e.startInfo?e.creditMoney=15e3:e.creditMoney=0,console.info("星星  : "+_typeof(e.startInfo)))},function(){})}function h(){var t=e.adultNum+e.oldNum+e.chilNum,n=parseInt(e.mFirstFee);e.downPayment=parseInt(e.mFirstFee),S=t*n,console.error(n+"zzzzzzzzzzzzzzzzzzzzzzz"),e.downPayment=S,e.showDownPayment=e.downPayment}function y(t,n,a,o,l){var i=document.createElement("ul");i.setAttribute("id","dynamic-ul");for(var c=0;a>c;c++){var r=document.createElement("li");$(r).addClass("date-li"),i.appendChild(r)}for(var d=0;t>d;d++){var r=document.createElement("li");$(r).addClass("date-li"),r.innerHTML=d+1,i.appendChild(r)}for(var s=g(l,o),m=new Date(s),u=m.getDay(),f=6-u,h=0;f>h;h++){var r=document.createElement("li");$(r).addClass("date-li"),i.appendChild(r)}var y=document.createElement("div");y.style.cssText="clear:both",i.appendChild(y),document.getElementById("travel_pick_wrap").appendChild(i),$(i).animateCss("fadeInRight");for(var P=!0,w=0;w<n.length;w++){var T=n[w].mDate.split("-")[2]-1+a,C=$("#dynamic-ul").children().eq(T),S=document.createElement("div"),v=document.createElement("span"),k=document.createElement("span");S.appendChild(v),S.appendChild(k),v.innerHTML="￥"+n[w].mOutPrice.toFixed(0),k.innerHTML="余"+n[w].mStock,v.className="travel-price-tag",k.className="travel-price-tag",C.children("div").children("span").css("color","#ea530c"),C.addClass("no_click"),C.addClass("click_li"),C.append(S),e.dialog=!1,C.data("pos",w+1),P&&(C.addClass("grad"),C.addClass("click_li"),C.removeClass("no_click"),e.departureDate=n[0].mDate,console.log("初始化--->成人价格为显示精确两位后结果测试"+e.adultPrice),C.children("div").children("span").addClass("gead_font"),P=!1)}$("#dynamic-ul li").on("click",function(){var t=$(this).data("pos")-1;$(this).children("div").children("span").html()&&($(".click_li").addClass("no_click"),$(this).removeClass("no_click"),$(this).siblings().children("div").children("span").removeClass("gead_font"),$(this).children("div").children("span").removeClass("travel-price-tag").addClass("gead_font"),$(this).select_css("grad"),$(this).children("div").children("span").css("color","#fffff"),$(this).children("div").children("span").addClass("travel-price-tag"),e.priceTag=!1,e.adultPrice=n[t].mOutPriceYoung,e.childPrice=n[t].mOutPriceChildren,e.oldPrice=n[t].mOutPriceOld,e.adultPollRoom=n[t].mOutDfc,e.oMealsId=n[t].mId,e.AdultRemainTicket=n[t].mStock,e.ChildRemainTicket=n[t].mStockChilren,e.OldRemainTicket=n[t].mStockOld,N(),e.departureDate=n[t].mDate,p(),e.$apply())})}function g(e,t){var n=new Date(e,t,0),a=e+"-"+t+"-"+n.getDate();return a}function P(e){localStorage.setItem("orderDetailInfo",e)}function N(){console.info("cc剩余票数统计为成人:"+e.AdultRemainTicket+"老人:"+e.OldRemainTicket+"儿童:"+e.ChildRemainTicket),console.log("AA初始化信息为单防差"+e.adultPollRoom+"成人价格"+e.adultPrice+"小孩价格:"+e.childPrice+"老人价格"+e.oldPrice)}function w(){var t=parseInt($("#travel_slide").css("width"))/3,n=new Swiper(".swiper-container",{slidesPerView:4.6,spaceBetween:15,freeMode:!0,initialSlide:.5});e.dateTagLength>4?(n.setWrapperTranslate(-t),$(".swiper-slide").css("left","1rem"),$(".swiper-slide").last().css("left","1rem")):(n.detachEvents(),n.setWrapperTranslate(t)),window.onload=function(){$(".iconfont-checkbox").eq(0).html("&#xe7c8;")}}function T(){function t(t){e.SingleRoomPoll=e.adultPollRoom*t}v.click_eve(v.ele),v.closeClick(v.closeELe),f(),console.log(e.installmentNum),e.fqNum=e.installmentNum.split(","),e.selectInstallment=function(t,n){e.installmentSelectedRow=n,e.oTotalDuration=t.fq,e.oDurationMoney=t.price,e.installmentNumShow=t.price+"×"+t.fq+"期",e.installmentNumShowPass=formatNum(t.price)+"×"+t.fq+"期",e.canSubmitOrder(),e.installmentEachPrice=t.price},e.$watch("dfcNum",function(n,a,o){t(e.dfcNum)}),e.$watch("calTotalPrice",function(n,a,o){t(e.dfcNum)}),e.$watch("SingleRoomPoll",function(t,n,a){console.info(e.SingleRoomPoll+"单房差价格显示精确两位 计算使用四位"),p()}),e.dfcAdd=function(){var t=e.adultNum+e.oldNum+e.chilNum;e.dfcNum<t&&e.dfcNum++},e.dfcReduce=function(){e.adultNum+e.chilNum+e.oldNum===0?e.dfcNum>1&&e.dfcNum--:e.dfcNum>0&&e.dfcNum--};for(var n=[],a=0;10>a;a++)n.push(a);e.poll=n,e.tickets=0,e.selectNum=function(t){if(e.signing){switch(t){case"chil":e.chilNum=e.engineer.chilCurrentNum;break;case"adult":e.adultNum=e.engineer.adultCurrentNum;break;case"old":e.oldNum=e.engineer.oldCurrentNum}e.canSubmitOrder()}else{switch(t){case"chil":e.chilNum=e.engineer.chilCurrentNum;break;case"adult":e.adultNum=e.engineer.adultCurrentNum,console.error("yyyy票数库存"+e.tickets);break;case"old":e.oldNum=e.engineer.oldCurrentNum}e.tickets=e.chilNum+e.adultNum+e.oldNum,e.canSubmitOrder(),e.tickets>e.AdultRemainTicket?(alert("票数库存不足"),e.isTicket=!1):e.isTicket=!0}l(),e.priceTag?(e.calTotalPrice=0,e.downPayment=0):($("#total_price").animateCss("flipInX"),setTimeout(function(){e.calTotalPrice=p(),e.$apply()},300))},e.getShopNum=function(){var t=e.adultNum+e.chilNum+e.oldNum;return t},e.reserveNow=function(){return e.isTicket?void(e.installmentCheck&&function(){if(e.shopNum=e.getShopNum(),0==e.shopNum)return void alert("购买数量必须大于等于1");e.downPayment==e.calTotalPrice&&(e.oTotalDuration=0,e.installmentEachPrice=0);var t;t="3"==e.fBtype?{title:e.pTitle,rCode:e.rCode,subTitle:e.pTitleSub,downPayment:e.downPayment,comboName:e.comboName,installment:e.installmentNumShowPass,departureDate:e.departureDate,shopNum:e.shopNum,creditMoney:e.creditMoney,oMealsId:e.oMealsId,oldNum:e.oldNum,childNum:e.chilNum,adultNum:e.adultNum,calTotalPrice:e.allTotalMoney,oTotalDuration:e.oTotalDuration,pId:e.pId,installmentEachPrice:e.installmentEachPrice,totalMoney:parseFloat(e.calTotalPrice)+parseFloat(e.poundages[e.installmentSelectedRow]*e.oTotalDuration),oTotalDfcMoney:e.SingleRoomPoll,oTotalSxfMoney:e.poundages[e.installmentSelectedRow],dfcNum:e.dfcNum,rateDescription:e.rateDescription}:{title:e.pTitle,rCode:e.rCode,subTitle:e.pTitleSub,downPayment:e.downPayment,comboName:e.comboName,installment:e.installmentNumShowPass,departureDate:e.departureDate,shopNum:e.shopNum,creditMoney:e.creditMoney,oMealsId:e.oMealsId,oldNum:e.oldNum,childNum:e.chilNum,adultNum:e.adultNum,calTotalPrice:e.allTotalMoney,oTotalDuration:e.oTotalDuration,pId:e.pId,installmentEachPrice:e.installmentEachPrice,totalMoney:parseFloat(e.calTotalPrice)+parseFloat(e.poundage*e.oTotalDuration),oTotalDfcMoney:e.SingleRoomPoll,oTotalSxfMoney:e.poundage,dfcNum:e.dfcNum,rateDescription:e.rateDescription},localStorage.getItem("orderDetailInfo")&&localStorage.removeItem("orderDetailInfo"),P(JSON.stringify(t)),go_page("./travel_order_detail.html")}()):void alert("票数库存不足")}}var C=[0,0,0,0,0,0,1];e.oldPrice=C[0],e.adultPrice=C[1],e.childPrice=C[2],e.adultPollRoom=C[3],e.chilNum=C[4],e.oldNum=C[5],e.adultNum=C[6],e.dateTagLength=0,e.dialog=!0,e.downPayment=0,e.installmentSelectedRow=-1,e.dfcNum=0,e.installmentNumShow="未选择",e.pTitle=GetQueryString("pTitle"),e.signing=GetQueryString("signing"),console.info("singing:  "+e.signing),e.token=getToken(),e.pId=GetQueryString("pId"),e.installmentNum=GetQueryString("installment"),e.pTitleSub=GetQueryString("pTitleSub"),e.priceTag=!1,e.rCode=GetQueryString("rCode")||"",e.creditMoney=0,e.calTotalPrice=0;var S=0;e.isTicket=!0,e.engineer={adultCurrentNum:1,chilCurrentNum:0,oldCurrentNum:0};var v={ele:$(".trevel-issue-icon"),click_eve:function(e){e.each(function(t){e.eq(t).on("click",function(){e.eq(t).prev().toggle(),e.eq(t).prev().animateCss("fadeInDown")})})},closeELe:$(".travel-info-dialog"),closeClick:function(e){e.each(function(t){e.eq(t).on("click",function(){$(this).hide()})})}};T(),a(),e.canSubmitOrder=function(){e.shopNum=e.getShopNum(),e.installmentSelectedRow<0||e.payCheckInfo||0==e.shopNum?e.installmentCheck=!1:e.installmentCheck=!0},e.checkFirstPayment=function(){e.downPayment||(e.downPayment=0),console.info("bbb"+e.downPayment);var t=e.downPayment==e.calTotalPrice;t?(e.installmentNumShowPass=formatNum(e.calTotalPrice)+"×0期",e.oTotalDuration=0,e.installmentEachPrice=0,e.installmentNumShow="无分期",e.installmentSelectedRow=-1,e.installmentCheck=!0,e.equalPrice=!0):(e.equalPrice=!1,e.canSubmitOrder())}});