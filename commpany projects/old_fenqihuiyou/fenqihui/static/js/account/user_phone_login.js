"use strict";var app=angular.module("loginApp",[]);app.controller("loginCtrl",["$scope","$http","$timeout",function(e,o,t){function n(o){e.state=o,e.codestate={display:"block"},t(function(){e.codestate={display:"none"}},1e3)}e.register={display:"none"},e.resultPhone=!1,e.resultPassword=!1,e.resultCode=!1,e.resultTime=!1,e.getCodeClick=!0,e.isReadDeal=!0,e.codeSend=!1,e.app=getTypeNative(),e.clearInput=function(o){e.phoneNum=""},e.clearShow={display:"block"},e.clearHidden={display:"none"},e.agreeDeal=function(){e.isReadDeal=!e.isReadDeal},e.toRealName=function(){var o=getToken();e.app?"ios"===e.app?window.webkit?window.webkit.messageHandlers.realNameAuthentication.postMessage({token:o}):realNameAuthentication(getToken()):"android"===e.app?android.realNameAuthentication(getToken()):"weixin"===e.app&&go_page("../travel/travel_upload_cdCard.html"):go_page("../../pages/recommended/recommended_index.html")},e.blurPhone=function(){e.checkPhone()},e.checkPhone=function(){var o=/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[0-9])[0-9]{8}$/;return""==e.phoneNum||null==e.phoneNum?(e.resultPhone=!1,void n("* 手机号不能为空！")):o.test(e.phoneNum)?void(e.resultPhone=!0):(e.resultPhone=!1,void n("* 手机号输入错误！"))},e.backTime=function(o){var t=o,n=setInterval(function(){t--,$("#getCode-button").val("重发("+t+")").attr("disabled","disabled").css("background","#AAAAAA"),0>=t&&(clearInterval(n),$("#getCode-button").val("重新发送").removeAttr("disabled").css("background","#ebc023"),e.getCodeClick=!0)},1e3)},e.getCodeRegister=function(){e.checkPhone(),e.resultPhone&&e.getCodeClick&&(e.getCodeClick=!1,e.getCodePort("0000"))},e.getCodePort=function(t){o({method:"POST",url:BaseUrl+"members/PhoneValidate",params:{phoneNum:e.phoneNum,type:t}}).then(function(o){switch(o.data.result){case"0000":e.codeSend=!0,n("发送成功"),e.backTime(60);break;case"9999":n("发送成功"),e.getCodeClick=!0;break;case"9998":n("系统异常"),e.getCodeClick=!0;break;case"1001":n("手机号无效"),e.getCodeClick=!0;break;case"1002":n("手机号已经被注册"),e.getCodeClick=!0;break;case"1005":n("用户不存在"),e.getCodeClick=!0;break;default:n(o.data.message),e.getCodeClick=!0}},function(){alert("网络异常！")})},e.blurCode=function(){e.checkCode()},e.checkCode=function(){return""==e.userCode||null==e.userCode?(n("* 验证码不能为空！"),void(e.resultCode=!1)):void(e.resultCode=!0)},e.loginSuccess=function(e){var o=getTypeNative();switch(o){case"ios":window.webkit?window.webkit.messageHandlers.setToken.postMessage({token:e}):setToken(e),$(".login-head").css("marginTop","1.1rem");break;case"android":android.setToken(e),$(".login-head").css("marginTop","1.1rem")}n("登录成功！正在跳转……");var t=GetQueryString("toUrl");null!=GetQueryString("toUrl")&&GetQueryString("toUrl").length>1?t.indexOf("?")>0?window.location.href=decodeURI(t+"&isLogin=1"):window.location.href=decodeURI(t+"?isLogin=1"):window.location.href="../../pages/recommended/recommended_index.html"},e.backHistory=function(){history.go(-1)},e.registerNow=function(){e.isReadDeal?(e.checkPhone(),e.resultPhone&&(e.codeSend?(e.checkCode(),1==e.resultCode?o({method:"POST",url:BaseUrl+"members/registOrLogin",params:{phoneNum:e.phoneNum,code:e.userCode,from:"3"}}).then(function(o){switch(n(o.data.message),o.data.result){case"0000":localStorage.setItem("fqhy_token",o.data.token),localStorage.setItem("realName",!1),e.flag=o.data.flag,"1"==o.data.status||"1"==e.flag?e.loginSuccess(o.data.token):(e.register={display:"block"},$(".register-shelter").animateCss("bounceInDown"))}},function(){alert("网络异常！")}):e.register=!1):n("请先获取验证码"))):n("请先阅读协议")},e.shelterHidden=function(){e.register={display:"none"}},e.registerSuccess=function(){go_page("../../pages/recommended/recommended_index.html")}}]);