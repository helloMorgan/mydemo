"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}();controllerFunc("ngScope","ngController",function(e,r,t,a){function n(r,a){t(function(){e.$apply(function(){e.pro_text="亲，"+r})},200),$("#layer").css("display","block"),$(".close_btn").click(function(){$("#layer").css("display","none"),a&&(window.location.href=a)})}var s=(GetQueryString("pId"),GetQueryString("fDuration"),GetQueryString("pTitle"),GetQueryString("pTitleSub"),new Dialog(DIALOG_LOAD)),l=function(){function t(){_classCallCheck(this,t);var r=[[],[],[]];e.travelImgs=r[0],e.receiptImgs=r[1],e.otherImgs=r[2];var a=[[],[],[]];e.travelImgs1=a[0],e.receiptImgs1=a[1],e.otherImgs1=a[2];var n=[[],[],[]];e.travelImgsPass=n[0],e.receiptImgsPass=n[1],e.otherImgsPass=n[2],e.images={localId:[],serverId:[],mediaId:[]},e.serverIds=[]}return _createClass(t,[{key:"passToSever",value:function(t){r({method:"POST",url:BaseUrl+"members/promoteStarLevelForWx",params:{imageIds:t,token:getToken()}}).then(function(r){r.data.result===SUCCESS_CODE?(e.passToServerNum++,s.hide(),n("上传成功","../../pages/account/user_personal.html")):1008==r.data.result?(n("请先实名"),s.hide()):1009==r.data.result?(n("已提交过申请，该申请正在审批"),s.hide()):2008==r.data.result?(n("请先开户"),s.hide()):(n("上传失败"),alert(r.data.result),s.hide())},function(){n("上传失败了"),s.hide()})}},{key:"addTravelImg",value:function(r){wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera"],success:function(t){e.images.localId.push(t.localIds),e.$apply(function(){var a;if((a=e[r]).push.apply(a,_toConsumableArray(t.localIds)),9==e[r].length){var n=r+"Full";e[n]=!0}})}})}},{key:"uploadToWeChat",value:function(r){var t;r.length>0&&(t=r.pop().toString());var a=this;wx.uploadImage({localId:t,isShowProgressTips:0,success:function(t){e.serverIds.push(t.serverId),r.length>0?a.uploadToWeChat(r):a.serializeData()},fail:function(e){alert("上传到微信服务器失败")}})}},{key:"downLoadImg",value:function(){function r(){wx.downloadImage({serverId:e.images.serverId[t],success:function(n){t++,e.images.mediaId.push(n.localId),alert("下载成功"),a>t&&r()}})}if(0===e.images.serverId.length)return void alert("请先使用 uploadImage 上传图片");var t=0,a=e.images.serverId.length;e.images.mediaId=[],r()}},{key:"verify",value:function(){return e.travelImgs.length>=1&&e.travelImgs.length<7&&e.receiptImgs.length>=1&&e.receiptImgs.length<7&&e.otherImgs.length<10}},{key:"submitContract",value:function(){var e=this;this.verify()&&function(){return s.show(),e.mergeArr(),!0}()}},{key:"removeImg",value:function(r,t){e[r].splice(t,1);var a=r+"Full";e[a]=!1}},{key:"mergeArr",value:function(){e.allImgsArr=[].concat(_toConsumableArray(e.otherImgs),_toConsumableArray(e.receiptImgs),_toConsumableArray(e.travelImgs)),e.travelLen=e.travelImgs.length,e.receiptLen=e.receiptImgs.length,e.otherImgsLen=e.travelImgs.length,this.uploadToWeChat(e.allImgsArr)}},{key:"serializeData",value:function(){for(var r=[],t=0,a=e.serverIds.length;a>t;t++){var n={imageId:e.serverIds[t]};t<e.travelLen?n.subType="1":t<e.receiptLen+e.travelLen?n.subType="2":n.subType="3",r.push(n)}this.passToSever(JSON.stringify(r))}}]),t}(),o=new l;e.addTravelImg=function(e){o.addTravelImg(e)},e.submitContract=function(){o.submitContract()},e.removeImg=function(e,r){o.removeImg(e,r)}});