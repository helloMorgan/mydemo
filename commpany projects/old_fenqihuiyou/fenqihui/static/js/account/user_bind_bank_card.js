"use strict";controllerFunc("userBindBank","userBindBankController",function(e,t,o){function n(t,n){o(function(){e.$apply(function(){e.pro_text="亲，"+t})},200),i.hide(),$("#layer").css("display","block"),$(".close_btn").click(function(){$("#layer").css("display","none"),null!=n&&(window.location.href=n)})}function a(t){o(function(){e.$apply(function(){e.pro_text="亲，"+t})},200);var n=getTypeNative();$("#layer").css("display","block"),$(".close_btn").click(function(){$("#layer").css("display","none"),"android"==n?android.idCardBack():"ios"==n?idCardBack():toIndex()})}e.resultPhone=!1,e.resultPassword=!1,e.resultCode=!1,e.codestate=!1,e.resultTime=!1,e.getCodeClick=!0,e.isLoader=!1,e.dialog=!1;var i=new Dialog(DIALOG_LOAD),c=$(".bankList option:checked").val(),r=$(".proList option:checked").val(),s=$(".cityList option:checked").val(),l=$(".bankList option:checked").text();e.prompt_text="",e.blurPhone=function(){e.checkPhone(),c=$(".bankList option:checked").val(),r=$(".proList option:checked").val(),s=$(".cityList option:checked").val(),e.resultPhone&&(e.msg="")},e.$watch("userCode",function(t,o){o!=t&&e.resultPhone&&(t.length>3&&"-1"!=c&&"-1"!=r&&"-1"!=s&&"null"!=t?$("button").removeClass("gray").addClass("pink").removeAttr("disabled"):$("button").removeClass("pink").addClass("gray").attr("disabled","disabled"))}),e.checkPhone=function(){var t=/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[0-9])[0-9]{8}$/;return""==e.phoneNum||null==e.phoneNum?(e.resultPhone=!1,n("手机号不能为空！"),!1):t.test(e.phoneNum)?(e.resultPhone=!0,!0):(e.resultPhone=!1,n("手机号输入错误！"),!1)},e.backTime=function(t){var o=t,n=setInterval(function(){o--,$("#getCode-button").val("重发("+o+")").attr("disabled","disabled"),0>=o&&(clearInterval(n),$("#getCode-button").val("重新发送").removeAttr("disabled"),e.getCodeClick=!0)},1e3)},e.blurCode=function(){e.checkCode()},e.checkCode=function(){return""==e.userCode||null==e.userCode?void(e.resultCode=!1):void(e.resultCode=!0)},e.getCodeAccount=function(){e.checkPhone(),e.resultPhone&&e.getCodeClick&&(e.getCodeClick=!1,e.getCodePortAccount())},e.complete=function(){i.show(),$("button").attr("disabled","true"),l=$(".bankList option:checked").text(),c=$(".bankList option:checked").val(),r=$(".proList option:checked").val(),s=$(".cityList option:checked").val();var o=$(".bankList option:checked").attr("name");-1!=r&&-1!=c&&-1!=s&&e.resultCode&&t({method:"POST",params:{token:getToken(),code:e.userCode,mobileNo:e.phoneNum,bankCode:c,cityCode:s,proCode:r,capAcntNo:e.bankCode,bankName:o},url:BaseUrl+"account/openAccount"}).success(function(t){if(void 0==t){var o="./user_login.html";n("登陆过期， 请重新登陆",o)}if(e.isLoader=!1,"0000"==t.result)a("绑卡成功"),i.hide();else if("2004"==t.result)n("请填写各类选项"),i.hide();else if("4009"==t.result)n("网咯忙， 请稍后再试");else if("4010"==t.result)o="./user_add_card.html",n("用户信息不一致",o);else if("4011"==t.result)n("请先实名验证");else if("4012"==t.result)n("短信验证码有误");else if("2009"==t.result)n("该银行卡已被其他帐号绑定");else{var o="./user_add_card.html";n("绑卡失败， 请重新绑定",o)}}).error(function(e){n("网络忙")})},e.getCodePortAccount=function(){t({method:"POST",url:BaseUrl+"members/PhoneValidate",params:{phoneNum:e.phoneNum,type:"2"}}).success(function(t){switch(e.codestate=!0,setTimeout(function(){e.$apply(function(){e.codestate=!1})},1e3),t.result){case"0000":e.state="发送成功",e.backTime(60);break;case"9999":e.prompt_text="发送短信失败",e.getCodeClick=!0;break;case"9998":e.prompt_text="系统异常",n(e.prompt_text),e.getCodeClick=!0;break;case"1001":e.prompt_text="手机号无效",n(e.prompt_text),e.getCodeClick=!0;break;case"1002":e.prompt_text="手机号已经被注册",n(e.prompt_text),e.getCodeClick=!0;break;case"1005":e.prompt_text="用户不存在",n(e.prompt_text),e.getCodeClick=!0;break;default:e.getCodeClick=!0}}).error(function(t){e.prompt_text="网络忙",n(e.prompt_text)})},$(document).ready(function(){i.show(),e.dialog=!0;var o=window.location.href.split("?"),a=Decrypt(o[1],"333"),c=a.split("&");if(e.bankCode=c[0].split("=")[1],e.name=c[1].split("=")[1],void 0!=e.name&&void 0!=e.bankCode)t({method:"POST",params:{token:getToken(),realName:e.name,capAcntNo:e.bankCode},url:BaseUrl+"account/openAccountFirst"}).success(function(t){if(t.result==SUCCESS_CODE){if(i.hide(),!t||!t.data){var o="./user_login.html";n("登陆过期， 请重新登陆",o)}for(var a=t.data,c=a.bankList,r=a.proList,s=a.cityList,l=0;l<c.length;l++)$(".bankList").append("<option value="+c[l].bankCode+" name="+c[l].bankName+">"+c[l].bankName+"</option>");$(r).each(function(e,t){$(".proList").append("<option value="+t.proCode+">"+t.proName+"</option>")}),$(".proList").change(function(){$(".cityList option").remove(),$(".cityList").append("<option value=>请选择地</option>");var e=$(".proList option:checked").val();$(s).each(function(t,o){e==o.cityCode&&$(".cityList").append("<option value="+o.proCode+">"+o.cityName+"</option>")})})}else e.isLoader=!1,e.prompt_text="网络繁忙",n(e.prompt_text)}).error(function(t){e.isLoader=!1,e.prompt_text="网络忙",n(e.prompt_text)});else{e.prompt_text="数据加载失败， 请重新绑定";var r="../../pages/account/user_add_card.html";n(e.prompt_text,r),e.isLoader=!1}})});