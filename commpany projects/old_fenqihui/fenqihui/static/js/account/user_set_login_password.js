"use strict";controllerFunc("userForgetLoginPassword","userForgetLoginPasswordController",function(e,o,s){function t(o){e.pro_text=o,e.isMsg=!1,s(function(){e.isMsg=!0},1e3,!0)}e.resultPhone=!1,e.resultCode=!1,e.resultTime=!1,e.getCodeClick=!0;var r=!1;e.isSetPasswod=!1,e.blurPhone=function(){e.checkPhone(),e.resultPhone&&(e.msg="")},e.isMsg=!0,e.checkPhone=function(){var o=/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[0-9])[0-9]{8}$/;return""==e.phoneNum||null==e.phoneNum?(e.resultPhone=!1,void t("手机号不能为空！")):o.test(e.phoneNum)?void(e.resultPhone=!0):(e.resultPhone=!1,void t("手机号输入错误！"))},e.backTime=function(o){var s=o,t=setInterval(function(){s--,$("#getCode-button").val("重发("+s+")").attr("disabled","disabled").css("background","#ccc"),0>=s&&(clearInterval(t),$("#getCode-button").val("重新发送").removeAttr("disabled").css("background","#ef6f00"),e.getCodeClick=!0)},1e3)},e.codeUp=function(){r&&(6==e.userCode.length&&"null"!=e.userCode?($(".register-now ").removeClass("gray").addClass("blue"),e.isSetPasswod=!0):($(".register-now ").removeClass("blue").addClass("gray"),e.isSetPasswod=!1))},e.getCodeRegister=function(){e.checkPhone(),e.resultPhone&&e.getCodeClick&&(e.msg="",e.getCodeClick=!1,e.getCodePortRegister())},e.getCodePortRegister=function(){o({method:"POST",url:BaseUrl+"members/PhoneValidate",params:{phoneNum:e.phoneNum,type:"3",token:getToken()}}).success(function(o){switch(o.result){case"0000":t("发送成功"),e.backTime(60),r=!0;break;case"9999":t("发送短信失败"),e.getCodeClick=!0;break;case"9998":t("系统异常"),e.getCodeClick=!0;break;case"1001":t("手机号无效"),e.getCodeClick=!0;break;case"1002":t("手机号已经被注册"),e.getCodeClick=!0;break;case"1005":t("用户不存在"),e.getCodeClick=!0;break;case"4004":t("登陆失效，请重新登陆"),e.getCodeClick=!0;break;case"1007":t("输入手机号与注册时的手机号码不匹配!"),e.getCodeClick=!0;break;default:e.getCodeClick=!0}}).error(function(){t("网络忙，请稍后再试")})},e.checkCode=function(){""!=e.userCode&&e.userCode?e.resultCode=!0:e.resultCode=!1},e.changePassword=function(){e.isSetPasswod&&(e.phoneNum?e.userCode||t("请输入短信码"):t("请输入手机号"),e.checkPhone(),e.checkCode(),e.resultPhone&&e.resultCode&&o({method:"POST",params:{token:getToken(),phoneNum:e.phoneNum,smsCode:e.userCode},url:BaseUrl+"members/setPwdPhoneValidate"}).success(function(e){"0000"==e.result?window.location.href="../../pages/account/user_set_account_psw.html?v="+Math.random():t("1102"==e.result?"验证码错误":"网络忙")}).error(function(){t("网络忙")}))}});