"use strict";var app=controllerFunc("newLoginApp","newLoginCtrl",function(e,t,o){function n(t){e.state=t,e.codestate={display:"block"},o(function(){e.codestate={display:"none"}},1e3)}e.msText="获取验证码",e.register={display:"none"},e.isReadDeal=!0,e.getCodeClick=!0,e.state="1111111111",e.codeSend=!1,e.resultPhone=!1,e.backTime=function(){var t=60;e.msText=t+"秒后重新获取",e.msStyle={fontSize:".55rem"};var o=setInterval(function(){t--,e.$apply(function(){e.msText=t+"秒后重新获取"}),0>=t&&(clearInterval(o),e.msStyle={fontSize:".8rem"},e.$apply(function(){e.msText="重新发送"}),e.getCodeClick=!0)},1e3)},e.getCodePort=function(o){t({method:"POST",url:BaseUrl+"members/PhoneValidate",params:{phoneNum:e.phoneNum,type:o,plat:1}}).then(function(t){switch(t.data.result){case"0000":e.codeSend=!0,n("发送成功"),e.backTime(60);break;case"9999":n("发送成功"),e.getCodeClick=!0;break;case"9998":n("系统异常"),e.getCodeClick=!0;break;case"1001":n("手机号无效"),e.getCodeClick=!0;break;case"1002":n("手机号已经被注册"),e.getCodeClick=!0;break;case"1005":n("用户不存在"),e.getCodeClick=!0;break;default:n(t.data.message),e.getCodeClick=!0}},function(){alert("网络异常！")})},e.checkPhone=function(){var t=/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[0-9])[0-9]{8}$/;return""==e.phoneNum||null==e.phoneNum?(e.resultPhone=!1,void n("* 手机号不能为空！")):t.test(e.phoneNum)?void(e.resultPhone=!0):(e.resultPhone=!1,void n("* 手机号输入错误！"))},e.toRealName=function(){go_page("../travel/travel_upload_cdCard.html")},e.checkCode=function(){return""==e.userCode||null==e.userCode?(n("* 验证码不能为空！"),void(e.resultCode=!1)):void(e.resultCode=!0)};var a=!0;e.login=function(){a&&(a=!1,e.isReadDeal?(e.checkPhone(),e.resultPhone&&(e.codeSend?(e.checkCode(),1==e.resultCode?t({method:"POST",url:BaseUrl+"members/registOrLogin",params:{phoneNum:e.phoneNum,code:e.userCode,from:"3"}}).then(function(t){switch(a=!0,n(t.data.message),t.data.result){case"0000":localStorage.setItem("fqh_token",t.data.token),e.flag=t.data.flag,"1"==t.data.status||"1"==e.flag?e.loginSuccess(t.data.token):(e.register={display:"block"},$(".register-shelter").animateCss("bounceInDown"))}},function(){a=!0,alert("网络异常！")}):(a=!0,e.register=!1)):(a=!0,n("请先获取验证码")))):(a=!0,n("请先阅读协议")))},e.loginSuccess=function(e){var t=getTypeNative();switch(t){case"ios":window.webkit?window.webkit.messageHandlers.setToken.postMessage({token:e}):setToken(e),$(".login-head").css("marginTop","1.1rem");break;case"android":android.setToken(e),$(".login-head").css("marginTop","1.1rem")}n("登录成功！正在跳转……");var o=GetQueryString("toUrl");null!=GetQueryString("toUrl")&&GetQueryString("toUrl").length>1?o.indexOf("?")>0?window.location.href=decodeURI(o+"&isLogin=1"):window.location.href=decodeURI(o+"?isLogin=1"):window.location.href="../../pages/recommended/recommended_index.html"},e.getCode=function(){e.checkPhone(),e.resultPhone&&e.getCodeClick&&(e.getCodeClick=!1,e.getCodePort("0000"))},e.clearInput=function(){e.phoneNum=""},e.agreeDeal=function(){e.isReadDeal=!e.isReadDeal},e.shelterHidden=function(){e.register={display:"none"}},e.registerSuccess=function(){go_page("../../pages/recommended/recommended_index.html")}});