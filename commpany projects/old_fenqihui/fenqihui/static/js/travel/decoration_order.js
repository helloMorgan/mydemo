"use strict";controllerFunc("ngOrder","ngOrderCtl",function(a,e,t,i){function d(a,t){var d=i.defer();return e({url:a,method:"POST",params:t}).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise}function r(){var e=JSON.parse(GetQueryString("dataUrl"));console.log(e),2==s&&(a.data.Business=e.business,a.data.produce=e.produce,a.data.firstPay=e.firstPay,a.data.prepay=e.prepay,a.data.price=e.price,a.data.time=e.time,a.data.shouldPay=e.shouldPay,a.data.oIsQianyue=1,a.data.contractNum=n,a.data.poundage=e.poundage,f=e.si_id,a.produce(e.si_id))}a.data={firstPay:"",prepay:"",price:"",produceArr:[],businessArr:[],timeArr:[],produce:"",Business:"",time:"",popup:!1,stages:!1,businessList:!1,timeList:!1,produceList:!1,initIndex:"",index:!1,warn:!1,warn1:!1,warn2:!1,dataPay:"",paymenPay:"",monthPay:"",p_price:"",shouldPay:"2000",interest:"",pId:"",poundage:""};var s=GetQueryString("urlState"),n=GetQueryString("contractNum"),o=GetQueryString("selectShope"),p=GetQueryString("sId"),u=GetQueryString("pId"),l=GetQueryString("pName"),c=!0,y=!0,m=!0,f=1,g=({business:a.data.Business,produce:a.data.produce,firstPay:a.data.firstPay,prepay:a.data.prepay,price:a.data.price,time:a.data.time,shouldPay:a.data.shouldPay},window.sessionStorage);a.state=GetQueryString("urlState"),a.popup=function(e){if(a.data.popup=!0,1==e)document.getElementsByClassName("swiper-containerBusiness")[0].style.visibility="visible",document.getElementsByClassName("popupSubmit")[0].style.visibility="visible",a.Business();else if(2==e){document.getElementsByClassName("swiper-containerProduce")[0].style.visibility="visible",document.getElementsByClassName("popupSubmit")[1].style.visibility="visible";var t=f;a.produce(t)}else{document.getElementsByClassName("swiper-containerTime")[0].style.visibility="visible",document.getElementsByClassName("popupSubmit")[2].style.visibility="visible";var i=g.getItem("prudece");a.time(i)}},a.stages=function(){a.data.popup=!0,a.data.stages=!0},a.popupVanish=function(){a.data.popup=!1,document.getElementsByClassName("swiper-containerProduce")[0].style.visibility="hidden",document.getElementsByClassName("swiper-containerTime")[0].style.visibility="hidden",document.getElementsByClassName("swiper-containerBusiness")[0].style.visibility="hidden",document.getElementsByClassName("popupSubmit")[0].style.visibility="hidden",document.getElementsByClassName("popupSubmit")[1].style.visibility="hidden",document.getElementsByClassName("popupSubmit")[2].style.visibility="hidden",a.data.stages=!1},a.Business=function(){d(BaseUrl+"suppliersInfo/getSuppliersInfoListByCondition").then(function(e){a.data.businessArr=e.data,g.setItem("businessArr",JSON.stringify(a.data.businessArr)),a.data.businessList=!0,t(function(){new Swiper(".swiper-containerBusiness",{initialSlide:0,direction:"vertical",slidesPerView:3,freeModeSticky:!0,spaceBetween:0,centeredSlides:!0,freeModeMomentumBounce:!1,onInit:function(e){o?a.data.Business=o:a.data.Business=a.data.businessArr[0].si_name},onTransitionEnd:function(e){a.data.businessArr[e.activeIndex].si_name?a.data.Business=a.data.businessArr[e.activeIndex].si_name:alert("商家名字为空或者不存在"),g.setItem("business",a.data.businessArr[e.activeIndex].si_id),f=a.data.businessArr[e.activeIndex].si_id}})})},function(a){console.log("接口请求失败"),console.log(a)})},a.Business(),a.produce=function(e){var i=[];i=JSON.parse(g.getItem("businessArr"));var r;p&&y?(y=!1,r=p):r=e?e:f;var s={psiid:r};d(BaseUrl+"fqhpro/getFqhProductByCondition",s).then(function(e){a.data.produceArr=e.data,g.setItem("produceArr",JSON.stringify(a.data.produceArr))," "!=a.data.produceArr?a.data.produce=a.data.produceArr[0].p_title:alert("商家名字为空或者不存在"),a.data.firstPay=a.data.produceArr[0].p_first_fee,a.data.dataPay=a.data.produceArr[0].p_first_fee,a.data.p_price=a.data.produceArr[0].p_price,a.data.pType=a.data.produceArr[0].pType,u?a.data.pId=u:a.data.pId=a.data.produceArr[0].p_id,t(function(){a.time()}),t(function(){new Swiper(".swiper-containerProduce",{initialSlide:0,direction:"vertical",slidesPerView:3,freeModeSticky:!0,spaceBetween:0,centeredSlides:!0,freeModeMomentumBounce:!1,onTransitionEnd:function(e){c&&l?(c=!1,a.data.produce=l):a.data.produceArr[e.activeIndex].p_title?a.data.produce=a.data.produceArr[e.activeIndex].p_title:alert("商家名字为空或者不存在"),g.setItem("prudece",a.data.produceArr[e.activeIndex].p_fee_id),a.data.firstPay=a.data.produceArr[e.activeIndex].p_first_fee,a.data.dataPay=a.data.produceArr[e.activeIndex].p_first_fee,a.data.p_price=a.data.produceArr[e.activeIndex].p_price,a.data.pType=a.data.produceArr[e.activeIndex].pType,m&&u?a.data.pId=u:a.data.pId=a.data.produceArr[e.activeIndex].p_id}})})},function(a){console.log("接口请求失败"),console.log(a)})},t(function(){a.produce()}),a.time=function(e){var t,i=JSON.parse(g.getItem("produceArr"));t=e?e:i[0].p_fee_id;var r={fId:t};d(BaseUrl+"feeRate/getFeeRateById",r).then(function(e){a.data.price<0&&(alert("请输入正确的金额(分期金额不能小于0)"),window.location.reload()),a.data.timeArr=e.data.fDuration.split(",")," "!=a.data.timeArr?a.data.time=a.data.timeArr[0]:alert("商家汇率为空或者不存在"),a.update=function(){a.data.interest=e.data.fFee.split(",")[0],a.data.prepay>=0&&a.data.firstPay?(a.data.poundage=(a.data.p_price-a.data.firstPay-a.data.prepay)*a.data.interest/a.data.time,a.data.shouldPay=Math.ceil((a.data.p_price-a.data.prepay-a.data.firstPay)/a.data.time+a.data.poundage),console.log("选择期数计算：  "+a.data.shouldPay)):console.log("请填写正确的金额")};new Swiper(".swiper-containerTime",{initialSlide:0,direction:"vertical",slidesPerView:3,freeModeSticky:!0,spaceBetween:0,centeredSlides:!0,freeModeMomentumBounce:!1,onInit:function(a){},onTransitionEnd:function(t){" "!=a.data.timeArr?a.data.time=a.data.timeArr[t.activeIndex]:alert("商家汇率为空或者不存在"),a.data.interest=e.data.fFee.split(",")[t.activeIndex],a.data.prepay>=0&&a.data.firstPay?(a.data.poundage=(a.data.p_price-a.data.firstPay-a.data.prepay)*a.data.interest/a.data.time,a.data.shouldPay=Math.ceil((a.data.p_price-a.data.prepay-a.data.firstPay)/a.data.time+a.data.poundage),console.log("轮播结束： "+a.data.interest)):console.log("请填写正确的金额")}})},function(a){console.log("接口请求失败"),console.log(a)})},a.popupSbumit=function(e){if(a.data.popup=!1,document.getElementsByClassName("swiper-containerProduce")[0].style.visibility="hidden",document.getElementsByClassName("swiper-containerTime")[0].style.visibility="hidden",document.getElementsByClassName("swiper-containerBusiness")[0].style.visibility="hidden",document.getElementsByClassName("popupSubmit")[0].style.visibility="hidden",document.getElementsByClassName("popupSubmit")[1].style.visibility="hidden",document.getElementsByClassName("popupSubmit")[2].style.visibility="hidden",1==e){g.getItem("business");a.produce(f)}else if(2==e){var t=g.getItem("prudece");a.time(t)}},a.load=function(){var e={business:a.data.Business,produce:a.data.produce,firstPay:a.data.firstPay,prepay:a.data.prepay,price:a.data.price,time:a.data.time,shouldPay:a.data.shouldPay,poundage:a.data.poundage,si_id:f,pType:a.data.pType};console.log(JSON.stringify(e)),a.data.firstPay&&a.data.prepay&&a.data.price&&a.data.shouldPay?go_page("../../pages/travel/travel_upload_contract.html",[{isOrder:1},{dataUrl:JSON.stringify(e)}]):0==parseInt(a.data.prepay)?go_page("../../pages/travel/travel_upload_contract.html",[{isOrder:1},{dataUrl:JSON.stringify(e)}]):alert("请输入正确金额")},a.onblue=function(e,t){function i(){a.data.prepay>=0&&a.data.firstPay&&(a.data.price=a.data.p_price-a.data.firstPay-a.data.prepay,a.time())}var d=new RegExp("^(([0-9]|([1-9][0-9]{0,9}))((.[0-9]{1,2})?))$");1==t?(d.test(e)?a.data.warn=!1:a.data.warn=!0,a.data.firstPay<a.data.dataPay&&alert("首付金额请输入不小于最低首付"+a.data.dataPay),i()):2==t?a.data.price<0?alert("请输入正确的金额(分期金额不能小于0)"):(i(),a.update(),d.test(e)?a.data.warn1=!1:a.data.warn1=!0):d.test(e)?a.data.warn2=!1:a.data.warn2=!0},a.orderPay=function(){var e={token:getToken(),oPId:a.data.pId,oTotalPrice:a.data.price,oTotalFirstPrice:a.data.firstPay,oPrepayMoney:a.data.prepay,oTotalDuration:a.data.time,oDurationMoney:a.data.shouldPay,oIsQianyue:0,oTotalSxfMoney:a.data.poundage*a.data.time},e={};if(e=2==a.state?{token:getToken(),oPId:a.data.pId,oTotalPrice:a.data.price,oTotalFirstPrice:a.data.firstPay,oPrepayMoney:a.data.prepay,oTotalDuration:a.data.time,oDurationMoney:a.data.shouldPay,oIsQianyue:1,oTotalSxfMoney:a.data.poundage*a.data.time,contractNum:n}:{token:getToken(),oPId:a.data.pId,oTotalPrice:a.data.price,oTotalFirstPrice:a.data.firstPay,oPrepayMoney:a.data.prepay,oTotalDuration:a.data.time,oDurationMoney:a.data.shouldPay,oIsQianyue:0,oTotalSxfMoney:a.data.poundage*a.data.time},a.data.firstPay&&a.data.prepay&&a.data.price&&a.data.shouldPay)a.data.firstPay>=a.data.dataPay?a.data.prepay<a.data.price?go_page("../../pages/travel/orderDetail.html",[{urlData:JSON.stringify(e)},{name:a.data.Business}]):alert("预付款金额不能大于分期金额"):alert("首付金额请输入不小于最低首付"+a.data.dataPay);else{var t=new RegExp("^([0-9])|([1-9]d+).d?$"),i=t.test(a.data.prepay),d=t.test(a.data.firstPay);0==parseInt(a.data.prepay)?a.data.firstPay>=a.data.dataPay?go_page("../../pages/travel/orderDetail.html",[{urlData:JSON.stringify(e)},{name:a.data.Business}]):d?alert("首付金额请输入不小于最低首付"+a.data.dataPay):alert("首付输入金额不能是小数,空值"):d?i?alert("金额不能为空，请检查"):alert("预付款输入金额不能是小数,空值"):alert("首付输入金额不能是小数,空值")}},t(function(){a.$apply(function(){r()})},200)});