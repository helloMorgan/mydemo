"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var o=a[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(a,t,o){return t&&e(a.prototype,t),o&&e(a,o),a}}();controllerFunc("ngScope","ngController",function(e,a,t,o){var n=0,r="";e.submitText="下一步";var i=function(){function t(){var a=this;_classCallCheck(this,t),e.preview="预览",e.canSubmit=!1,e.uploadCd=function(){return a.uploadCd(!0)},e.ALREADY_REAL="1203",e.FORMAT_ERROR="1201",e.toast=new Dialog(DIALOG_TOAST),e.dialog=new Dialog(DIALOG_LOAD),e.submitCdCard=function(){e.canSubmit&&function(){a.uploadCd()}()}}return _createClass(t,[{key:"passToServer",value:function(t){e.toast.dialog.innerHTML="身份证识别失败,请按规范进行拍照",a({method:"POST",url:BaseUrl+"ocr/ocrInfoWx",params:{imageId:t,token:getToken()}}).then(function(a){a.data.result===SUCCESS_CODE?(e.idCard=a.data.idCard,e.name=a.data.name,e.canSubmit=!0,alert("身份证识别成功, 请继续下一步人脸识别"),e.submitText="身份证识别成功, 请进行自拍"):"7002"==a.data.result?alert("请拍摄清晰身份证照片!"):e.toast.show(3e3,"10rem"),e.dialog.hide()},function(){e.toast.show(3e3,"10rem"),e.dialog.hide()})}},{key:"passFaceToServer",value:function(t){return e.defer=o.defer(),a({method:"POST",url:BaseUrl+"ocr/verifyInfoWx",params:{imageId:t,token:getToken(),idCard:e.idCard,name:e.name}}).then(function(a){a.data.result===SUCCESS_CODE&&a.data.confidenceRst&&1==a.data.confidenceRst?(e.dialog.hide(),e.toast.dialog.innerHTML="人脸识别成功",e.toast.show(3e3),e.defer.resolve(t)):(e.dialog.hide(),e.toast.dialog.innerHTML="人脸识别失败",e.toast.show(3e3))},function(){e.toast.dialog.innerHTML="人脸识别失败",e.toast.show(3e3),e.dialog.hide()}),e.defer.promise}},{key:"certification",value:function(){a({method:"POST",url:BaseUrl+"members/realNameCertificationForWx",params:{imageId:r,token:getToken(),idCard:e.idCard,realName:e.name}}).then(function(a){a.data.result===SUCCESS_CODE?go_page("../account/user_add_card.html"):a.data.result===e.ALREADY_REAL?(e.toast.dialog.innerHTML="身份证已被绑定",e.toast.show(3e3,"10rem")):a.data.result===e.FORMAT_ERROR?(e.toast.dialog.innerHTML="身份证号格式不正确",e.toast.show(3e3,"10rem")):alert("实名认证失败")},function(){alert("实名认证失败")})}},{key:"uploadCd",value:function(a){var t=this;wx.chooseImage({count:1,sizeType:["compressed"],sourceType:["camera"],success:function(o){e.$apply(function(){a?(e.haveImg=!0,document.getElementById("imgShow").setAttribute("src",o.localIds[0]),t.uploadToWx(o.localIds,"ok")):t.uploadToWx(o.localIds)})}})}},{key:"uploadToWx",value:function(a,t){var o=this;e.dialog.show();var i;a.length>0&&(i=a[0]),wx.uploadImage({localId:i.toString(),isShowProgressTips:0,success:function(e){0==n++&&(r=e.serverId),t?o.passToServer(e.serverId):o.passFaceToServer(e.serverId).then(o.certification)},fail:function(e){alert(JSON.stringify(e))}})}}]),t}();new i});