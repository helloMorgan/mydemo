"use strict";var app=angular.module("loginApp",[]);app.controller("loginCtrl",["$scope","$http",function(e,s){e.msg="",e.codestate=!1,e.isPhone=!1,e.isPassword=!1,e.clearInput=function(s){e.phoneNum=""},e.clearShow={display:"block"},e.clearHidden={display:"none"},e.backHistory=function(){history.go(-1)},isOpenInWeixin(),e.passwordEye=function(e){"password"==$(".login-eye").prev().attr("type")?($(".login-eye").prev().attr("type","text"),$(".login-eye").html("&#xe634;").css("color","#EC6700")):($(".login-eye").prev().attr("type","password"),$(".login-eye").html("&#xe621;").css("color","#2b677b"))},e.blurPhone=function(){e.checkPhone(),e.isPhone&&(e.msg="")},e.checkPhone=function(){var s=/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[0-9])[0-9]{8}$/;return""==e.phoneNum||null==e.phoneNum?(e.isPhone=!1,void(e.msg="* 请输入用户名/手机号码！")):s.test(e.phoneNum)?void(e.isPhone=!0):(e.isPhone=!1,void(e.msg="* 请输入11位手机号码！"))},e.blurPassword=function(){e.checkPassword(),e.isPassword&&(e.msg="")},e.checkPassword=function(){var s=/^([a-z]|[A-Z]|[0-9]){6,16}$/;return null==e.password||""==e.password?(e.msg="* 请输入您的登录密码！",void(e.isPassword=!1)):s.test(e.password)?void(e.isPassword=!0):(e.msg="* 请输入6-16位数字/字母组合密码！",void(e.isPassword=!1))},$("#code-state").css("border","1px solid red"),e.loginNow=function(){if(e.checkPassword(),e.checkPhone(),e.isPhone&&e.isPassword){e.msg="";var o={phoneNum:e.phoneNum,password:e.password,from:"3"};s({method:"POST",url:BaseUrl+"/members/login",params:o}).success(function(s){switch(e.codestate=!0,setTimeout(function(){e.$apply(function(){e.codestate=!1})},1e3),s.result){case"0000":e.state="登录成功",e.codestate=!0,$("#code-state").css("display","block"),e.loginSuccess(s.token);break;case"1004":e.codestate=!0,e.state="用户名或密码错误";break;case"1005":e.state="用户不存在",e.codestate=!0;break;case"9999":e.state="网络异常",e.codestate=!0;break;default:e.state="未知错误",e.codestate=!0,$("#code-state").css("display","block")}setTimeout(function(){e.$apply(function(){e.codestate=!1,e.state=""})},1e3)})}},e.password="",e.$watch("password",function(){var s=e.password.length-1;/^[a-zA-Z0-9]*$/.test(e.password)?e.msg="":(e.msg="* 请输入字母数字组合！",e.isPassword=!1,e.password=e.password.slice(0,s))}),e.loginSuccess=function(s){localStorage.setItem("fqhy_token",s),localStorage.setItem("realName",!1);var o=getTypeNative();switch(o){case"ios":window.webkit?window.webkit.messageHandlers.setToken.postMessage({token:s}):setToken(s),$(".login-head").css("marginTop","1.1rem");break;case"android":android.setToken(s),$(".login-head").css("marginTop","1.1rem")}e.state="登录成功！正在跳转……";var t=GetQueryString("toUrl");null!=GetQueryString("toUrl")&&GetQueryString("toUrl").length>1?t.indexOf("?")>0?window.location.href=decodeURI(t+"&isLogin=1"):window.location.href=decodeURI(t+"?isLogin=1"):window.location.href="../../pages/recommended/recommended_index.html"}}]);